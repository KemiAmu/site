<!doctype html>
<html x-data="app">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Calculate intersection points between two circles using this interactive calculator."
        />
        <meta name="author" content="Kemi-Amu" />
        <title>Circle Intersection Calculator</title>
        <link rel="icon" href="../assets/favicon.svg" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
        />
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
        <style>
            input {
                font-family: monospace;
            }
            .coordinate-result {
                font-family: monospace;
            }
        </style>
        <script>
            document.addEventListener("alpine:init", () => {
                Alpine.data("app", () => ({
                    lang: localStorage.getItem("lang"),
                    translations: {
                        "Circle Intersection Calculator": {
                            zh: "圆相交计算器",
                            de: "Kreisschnittpunkt-Rechner",
                        },
                        "Calculate intersection points between two circles": {
                            zh: "计算两个圆的交点",
                            de: "Schnittpunkte zwischen zwei Kreisen berechnen",
                        },
                        "Circle 1": {
                            zh: "圆1",
                            de: "Kreis 1",
                        },
                        "Circle 2": {
                            zh: "圆2",
                            de: "Kreis 2",
                        },
                        "Center Point": {
                            zh: "中心点",
                            de: "Mittelpunkt",
                        },
                        Radius: {
                            zh: "半径",
                            de: "Radius",
                        },
                        "Intersection Points": {
                            zh: "交点",
                            de: "Schnittpunkte",
                        },
                        "The circles do not intersect.": {
                            zh: "圆不相交",
                            de: "Die Kreise schneiden sich nicht.",
                        },
                        Point: {
                            zh: "点",
                            de: "Punkt",
                        },
                        "← Back to Home": {
                            zh: "← 返回主页",
                            de: "← Zurück zur Startseite",
                        },
                    },
                    t(key) {
                        return this.translations[key]?.[this.lang] || key;
                    },
                }));

                Alpine.data("circleIntersect", () => ({
                    circle1: { x: null, y: null, r: null },
                    circle2: { x: null, y: null, r: null },
                    intersections: [],

                    calculate() {
                        const points = this.circleIntersection(
                            this.circle1.x,
                            this.circle1.y,
                            this.circle1.r,
                            this.circle2.x,
                            this.circle2.y,
                            this.circle2.r,
                        );
                        this.intersections = points.map(([x, y]) => ({
                            x: x.toFixed(4),
                            y: y.toFixed(4),
                        }));
                    },

                    circleIntersection(x1, y1, r1, x2, y2, r2) {
                        const dx = x2 - x1;
                        const dy = y2 - y1;
                        const dSquared = dx * dx + dy * dy;
                        const r1Squared = r1 * r1;
                        const r2Squared = r2 * r2;
                        const minDistance = Math.abs(r1 - r2);
                        const maxDistance = r1 + r2;

                        if (
                            dSquared === 0 ||
                            dSquared < minDistance * minDistance ||
                            dSquared > maxDistance * maxDistance
                        ) {
                            return [];
                        }

                        const distance = Math.sqrt(dSquared);
                        const invD = 1 / distance;
                        const a =
                            (r1Squared - r2Squared + dSquared) * 0.5 * invD;
                        const h = Math.sqrt(Math.max(0, r1Squared - a * a));
                        const ux = dx * invD;
                        const uy = dy * invD;
                        const mx = x1 + a * ux;
                        const my = y1 + a * uy;

                        return [
                            [mx - uy * h, my + ux * h],
                            [mx + uy * h, my - ux * h],
                        ];
                    },
                }));
            });
        </script>
    </head>
    <body class="container" x-data="circleIntersect" x-init="calculate()">
        <main>
            <hgroup>
                <h1 x-text="t('Circle Intersection Calculator')"></h1>
                <h2
                    x-text="t('Calculate intersection points between two circles')"
                ></h2>
            </hgroup>

            <div class="grid">
                <!-- Circle 1 Inputs -->
                <div>
                    <article>
                        <header>
                            <h2 x-text="t('Circle 1')"></h2>
                        </header>
                        <label>
                            <span x-text="t('Center Point')"></span>
                            <input
                                type="number"
                                x-model.number="circle1.x"
                                @input="calculate()"
                                placeholder="X"
                            />
                            <input
                                type="number"
                                x-model.number="circle1.y"
                                @input="calculate()"
                                placeholder="Y"
                            />
                        </label>
                        <label>
                            <span x-text="t('Radius')"></span>
                            <input
                                type="number"
                                x-model.number="circle1.r"
                                min="0"
                                step="0.1"
                                @input="calculate()"
                                placeholder="Radius"
                            />
                        </label>
                    </article>
                </div>

                <!-- Circle 2 Inputs -->
                <div>
                    <article>
                        <header>
                            <h2 x-text="t('Circle 2')"></h2>
                        </header>
                        <label>
                            <span x-text="t('Center Point')"></span>
                            <input
                                type="number"
                                x-model.number="circle2.x"
                                @input="calculate()"
                                placeholder="X"
                            />
                            <input
                                type="number"
                                x-model.number="circle2.y"
                                @input="calculate()"
                                placeholder="Y"
                            />
                        </label>
                        <label>
                            <span x-text="t('Radius')"></span>
                            <input
                                type="number"
                                x-model.number="circle2.r"
                                min="0"
                                step="0.1"
                                @input="calculate()"
                                placeholder="Radius"
                            />
                        </label>
                    </article>
                </div>

                <!-- Results -->
                <div>
                    <article>
                        <header>
                            <h2 x-text="t('Intersection Points')"></h2>
                        </header>
                        <div id="result" class="coordinate-result">
                            <template x-if="intersections.length === 0">
                                <p
                                    x-text="t('The circles do not intersect.')"
                                ></p>
                            </template>
                            <template x-for="(point, index) in intersections">
                                <p>
                                    <span x-text="t('Point')"></span>
                                    <span x-text="index + 1"></span>:
                                    <span>
                                        (<span x-text="point.x"></span>,
                                        <span x-text="point.y"></span>)
                                    </span>
                                </p>
                            </template>
                        </div>
                    </article>
                </div>
            </div>
        </main>
        <footer>
            <p>
                <a href="../" x-text="t('← Back to Home')"></a>
            </p>
            <p>
                <a @click="lang = 'en'; localStorage.setItem('lang', 'en')">
                    English
                </a>
                /
                <a @click="lang = 'zh'; localStorage.setItem('lang', 'zh')">
                    中文
                </a>
                /
                <a @click="lang = 'de'; localStorage.setItem('lang', 'de')">
                    Deutsch
                </a>
            </p>
        </footer>
    </body>
</html>
