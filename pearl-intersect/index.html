<!doctype html>
<html x-data="app">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Calculate the approximate location of a Minecraft stronghold from two ender pearl throws."
        />
        <meta name="author" content="Kemi-Amu" />
        <title>Ender Pearl Intersection Calculator</title>
        <link rel="icon" href="../assets/favicon.svg" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
        />
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
        <style>
            input {
                font-family: monospace;
            }
            .coordinate-result {
                font-family: monospace;
            }
        </style>
        <script>
            document.addEventListener("alpine:init", () => {
                Alpine.data("app", () => ({
                    lang: localStorage.getItem("lang"),
                    translations: {
                        "Ender Pearl Intersection Calculator": {
                            zh: "末影珍珠交点计算器",
                            de: "Enderperlen-Schnittpunkt-Rechner",
                        },
                        "Calculate stronghold location from two pearl throws": {
                            zh: "通过两次珍珠投掷计算要塞位置",
                            de: "Festungsposition aus zwei Perlenwürfen berechnen",
                        },
                        "Throw 1": {
                            zh: "第一次投掷",
                            de: "Wurf 1",
                        },
                        "Throw 2": {
                            zh: "第二次投掷",
                            de: "Wurf 2",
                        },
                        Position: {
                            zh: "位置",
                            de: "Position",
                        },
                        "Yaw Angle (-180 to 180)": {
                            zh: "偏航角 (-180 到 180)",
                            de: "Gierwinkel (-180 bis 180)",
                        },
                        "Stronghold Location": {
                            zh: "要塞位置",
                            de: "Festungsposition",
                        },
                        "Approximate coordinates of the stronghold": {
                            zh: "要塞的近似坐标",
                            de: "Ungefähre Koordinaten der Festung",
                        },
                        "Lines are parallel! No intersection found.": {
                            zh: "直线平行！未找到交点。",
                            de: "Linien sind parallel! Kein Schnittpunkt gefunden.",
                        },
                        "← Back to Home": {
                            zh: "← 返回主页",
                            de: "← Zurück zur Startseite",
                        },
                        "Unofficial Minecraft tool. Not affiliated with Mojang or Microsoft.":
                            {
                                zh: "非官方Minecraft工具。与Mojang或微软无关。",
                                de: "Inoffizielles Minecraft-Tool. Nicht mit Mojang oder Microsoft verbunden.",
                            },
                    },
                    t(key) {
                        return this.translations[key][this.lang] || key;
                    },
                }));

                Alpine.data("pearlIntersect", () => ({
                    throw1: { x: null, z: null, yaw: null },
                    throw2: { x: null, z: null, yaw: null },
                    intersection: null,
                    error: null,

                    calculate() {
                        this.error = null;
                        this.intersection = null;

                        const toRad = (deg) => (deg * Math.PI) / 180;
                        const yaw1Rad = toRad(this.throw1.yaw);
                        const yaw2Rad = toRad(this.throw2.yaw);

                        const getDirection = (yawRad) => ({
                            dx: -Math.sin(yawRad),
                            dz: Math.cos(yawRad),
                        });

                        const dir1 = getDirection(yaw1Rad);
                        const dir2 = getDirection(yaw2Rad);

                        const denominator =
                            dir1.dx * dir2.dz - dir2.dx * dir1.dz;

                        if (Math.abs(denominator) < 1e-3) {
                            this.error =
                                "Lines are parallel! No intersection found.";
                            return;
                        }

                        const deltaZ = this.throw2.z - this.throw1.z;
                        const deltaX = this.throw2.x - this.throw1.x;
                        const t =
                            (dir1.dz * deltaX - dir1.dx * deltaZ) / denominator;

                        this.intersection = {
                            x: this.throw2.x + t * dir2.dx,
                            z: this.throw2.z + t * dir2.dz,
                        };
                    },
                }));
            });
        </script>
    </head>
    <body class="container" x-data="pearlIntersect" x-init="calculate()">
        <main>
            <hgroup>
                <h1 x-text="t('Ender Pearl Intersection Calculator')"></h1>
                <h2
                    x-text="t('Calculate stronghold location from two pearl throws')"
                ></h2>
            </hgroup>

            <div class="grid">
                <!-- First Throw -->
                <div>
                    <article>
                        <header>
                            <h2 x-text="t('Throw 1')"></h2>
                        </header>
                        <label>
                            <span x-text="t('Position')"></span>
                            <input
                                type="number"
                                x-model.number="throw1.x"
                                placeholder="X"
                                @input="calculate()"
                            />
                            <input
                                type="number"
                                x-model.number="throw1.z"
                                placeholder="Z"
                                @input="calculate()"
                            />
                        </label>
                        <label>
                            <span x-text="t('Yaw Angle (-180 to 180)')"></span>
                            <input
                                type="number"
                                x-model.number="throw1.yaw"
                                min="-180"
                                max="180"
                                placeholder="Yaw"
                                @input="calculate()"
                            />
                        </label>
                    </article>
                </div>

                <!-- Second Throw -->
                <div>
                    <article>
                        <header>
                            <h2 x-text="t('Throw 2')"></h2>
                        </header>
                        <label>
                            <span x-text="t('Position')"></span>
                            <input
                                type="number"
                                x-model.number="throw2.x"
                                placeholder="X"
                                @input="calculate()"
                            />
                            <input
                                type="number"
                                x-model.number="throw2.z"
                                placeholder="Z"
                                @input="calculate()"
                            />
                        </label>
                        <label>
                            <span x-text="t('Yaw Angle (-180 to 180)')"></span>
                            <input
                                type="number"
                                x-model.number="throw2.yaw"
                                min="-180"
                                max="180"
                                placeholder="Yaw"
                                @input="calculate()"
                            />
                        </label>
                    </article>
                </div>
                <!-- Result Section -->
                <div>
                    <article>
                        <header>
                            <h2 x-text="t('Stronghold Location')"></h2>
                            <p
                                x-text="t('Approximate coordinates of the stronghold')"
                            ></p>
                        </header>
                        <div id="result" class="coordinate-result">
                            <template x-if="error">
                                <p class="error" x-text="t(error)"></p>
                            </template>
                            <template x-if="intersection">
                                <div>
                                    <p>
                                        (<span
                                            x-text="intersection.x.toFixed(2)"
                                        ></span
                                        >,
                                        <span
                                            x-text="intersection.z.toFixed(2)"
                                        ></span
                                        >)
                                    </p>
                                </div>
                            </template>
                        </div>
                    </article>
                </div>
            </div>
        </main>
        <footer>
            <p><a href="../" x-text="t('← Back to Home')"></a></p>
            <p
                x-text="t('Unofficial Minecraft tool. Not affiliated with Mojang or Microsoft.')"
            ></p>
            <p>
                <a @click="lang = 'en'; localStorage.setItem('lang', 'en')">
                    English
                </a>
                /
                <a @click="lang = 'zh'; localStorage.setItem('lang', 'zh')">
                    中文
                </a>
                /
                <a @click="lang = 'de'; localStorage.setItem('lang', 'de')">
                    Deutsch
                </a>
            </p>
        </footer>
    </body>
</html>
